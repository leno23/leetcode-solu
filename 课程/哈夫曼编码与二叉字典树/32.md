32. 最长有效括号

给你一个只包含 '(' 和 ')' 的字符串，找出最长有效（格式正确且连续）括号子串的长度。

示例 1：

输入：s = "(()"
输出：2
解释：最长有效括号子串是 "()"

```js
var longestValidParentheses = function (s) {
    let ans = 0;
    // 以下标为i结尾的字符串的最长有效果括号的长度
    let dp = Array(s.length).fill(0)
    // 有效括号的长度至少是2
    for (let i = 1; i < s.length; i++) {
        // 以(结尾的肯定不是有效括号
        if (s[i] == '(') dp[i] = dp[i - 1]
        else {
            // 当前字符是)
            // 上一位是( 则可以和当前的)组成一对，
            if (s[i - 1] == '(') {
                // 上一位也是 )，那么前面会有一段有效括号以i-1为结尾
                // (  )   ( ( ( ) ( ) ( )  )  " ) "
                //    ↑   ↑                ↑    ↑
                //   j-1  j               i-1   i
                // 计算前面一段有效括号的前一位
                let j = i - dp[i - 1] - 1
                // 如果这一位是( 则可以和 第i为的) 组成有效括号
                if (s[j] == '(') {
                    // 由于第j为和第i为组成了一对括号，所以第j位到第i为也是有效括号，长度为1 + dp[i-1] + 1
                    // 如果第j位前面还有字符，需要再加上 dp[j-1]的值，
                    // 第i为的最长括号 = 
                    dp[i] = dp[i - 1]  + 2 + (dp[j - 1] || 0);
                }
            }
        }
        ans = Math.max(ans, dp[i]);
    }
    return ans;
};
```
